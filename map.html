<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>ë°•ì°¬ëŒ€ ìœ ì„¸ ì§€ë„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    /* â”€â”€ ê¸°ë³¸ ë ˆì´ì•„ì›ƒ â”€â”€ */
    body {
      margin: 0; padding: 0;
      display: flex; height: 100vh;
      font-family: 'Segoe UI', sans-serif;
    }
    #map { flex: 1; }

    /* â”€â”€ ì‚¬ì´ë“œë°” â”€â”€ */
    #sidebar {
      width: 300px;
      padding: 15px;
      background: #fff;
      border-left: 1px solid #ddd;
      box-shadow: -2px 0 5px rgba(0,0,0,0.1);
      overflow-y: auto;
    }
    #sidebar h3 {
      margin-top: 0;
      font-size: 1.2em;
      color: #007bff;
      border-bottom: 2px solid #007bff;
      padding-bottom: 5px;
    }
    #schedule-list {
      list-style: none;
      padding-left: 0;
      margin-top: 10px;
    }
    #schedule-list li {
      margin-bottom: 8px;
      font-size: 0.95em;
    }

    /* â”€â”€ íˆ´íŒ (ì¥ì†Œ í…ìŠ¤íŠ¸) â”€â”€ */
    .leaflet-tooltip {
      background: rgba(255,255,255,0.9);
      border: none;
      box-shadow: 0 1px 4px rgba(0,0,0,0.25);
      border-radius: 4px;
      font-size: 10px;    /* í…ìŠ¤íŠ¸ í¬ê¸° ì‘ê²Œ */
      padding: 2px 6px;   /* ì—¬ë°± ì¡°ì • */
      color: #333;
    }

    /* â”€â”€ íŒì—… ëª¨ì„œë¦¬ â”€â”€ */
    .leaflet-popup-content-wrapper {
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    /* â”€â”€ ë²”ë¡€ & ì´ê±°ë¦¬ â”€â”€ */
    #legend, #total-distance {
      position: absolute;
      background: rgba(255,255,255,0.95);
      padding: 8px 12px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      font-size: 13px;
      color: #333;
      z-index: 1000;
    }
    #legend { top: 15px; left: 15px; }
    #total-distance { bottom: 15px; left: 15px; font-weight: 600; }

    /* â”€â”€ í•„í„° ë²„íŠ¼ â”€â”€ */
    .filter-button {
      margin: 5px 5px 5px 0;
      padding: 6px 12px;
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9em;
      transition: background 0.2s;
    }
    .filter-button:hover { background: #0056b3; }
    .filter-button.active {
      background: #0056b3;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>

  <!-- ì§€ë„ -->
  <div id="map"></div>

  <!-- ì‚¬ì´ë“œë°” -->
  <div id="sidebar">
    <h3>ğŸ“… ìœ ì„¸ ì¼ì •</h3>
    <div id="filter-controls"></div>
    <ul id="schedule-list"></ul>
  </div>

  <!-- ë²”ë¡€ -->
  <div id="legend">
    <strong>ì¼ìë³„</strong><br>
    ğŸ”µ 5ì›” 12ì¼<br>
    ğŸŸ¢ 5ì›” 13ì¼<br>
    ğŸŸ¡ 5ì›” 14ì¼<br>
    ğŸŸ£ 5ì›” 15ì¼
  </div>

  <!-- ì´ ì´ë™ ê±°ë¦¬ -->
  <div id="total-distance">ì´ ì´ë™ ê±°ë¦¬: 0 km</div>

  <!-- Leaflet + Turf.js -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

  <script>
    // 1) ì¼ì • ë°ì´í„°
    const schedule = [
      { date: "5ì›” 12ì¼", time: "09:00", title: "ì¤‘ì•™ì„ ê±°ëŒ€ì±…ìœ„ì›íšŒ ì¶œì •ì‹", coords: [37.5704, 126.9769], color: 'blue' },
      { date: "5ì›” 12ì¼", time: "12:30", title: "ì‹ í¬ì‹œì¥", coords: [37.4717, 126.6212], color: 'blue' },
      { date: "5ì›” 12ì¼", time: "13:00", title: "ë‹µë™ì„±ë‹¹ ì• ì‚¬ê±°ë¦¬", coords: [37.4727, 126.6232], color: 'blue' },
      { date: "5ì›” 12ì¼", time: "14:00", title: "ê°€ì¢Œì‹œì¥", coords: [37.4932, 126.6756], color: 'blue' },
      { date: "5ì›” 12ì¼", time: "15:00", title: "ì²­ë¼ë¡¯ë°ë§ˆíŠ¸", coords: [37.5386, 126.6298], color: 'blue' },
      { date: "5ì›” 12ì¼", time: "16:00", title: "ê³„ì‚°ì—­ ì‚¬ê±°ë¦¬", coords: [37.5383, 126.7253], color: 'blue' },
      { date: "5ì›” 12ì¼", time: "18:00", title: "ì¸ì²œì˜ ë¹› ìœ ì„¸ë³¸ë¶€ ì¶œì •ì‹", coords: [37.4898, 126.7213], color: 'blue' },
      { date: "5ì›” 12ì¼", time: "19:30", title: "ë¶€í‰ì—­ ì¸ê·¼ ìƒê°€", coords: [37.4906, 126.7223], color: 'blue' },
      { date: "5ì›” 13ì¼", time: "10:00", title: "ì˜ˆì‚°ì—­ì „ì‹œì¥", coords: [36.6802, 126.8471], color: 'green' },
      { date: "5ì›” 13ì¼", time: "11:20", title: "ë‚´í¬ì‹œ ìƒê°€ë°©ë¬¸", coords: [36.6588, 126.6723], color: 'green' },
      { date: "5ì›” 13ì¼", time: "14:00", title: "ë…¼ì‚°í™”ì§€ì‹œì¥", coords: [36.1918, 127.0887], color: 'green' },
      { date: "5ì›” 13ì¼", time: "15:00", title: "ë…¼ì‚°ì‹œì¥ ìƒì¸íšŒ", coords: [36.1918, 127.0887], color: 'green' },
      { date: "5ì›” 13ì¼", time: "16:00", title: "ê³„ë£¡ ê°„ë‹´íšŒ", coords: [36.2744, 127.2431], color: 'green' },
      { date: "5ì›” 13ì¼", time: "16:30", title: "ê³„ë£¡ì‹œì¥", coords: [36.2764, 127.2428], color: 'green' },
      { date: "5ì›” 13ì¼", time: "17:30", title: "ê¸ˆì•”ì‚¬ê±°ë¦¬", coords: [36.2798, 127.2382], color: 'green' },
      { date: "5ì›” 14ì¼", time: "13:10", title: "ì œì²œ ë‚´í† ì‹œì¥", coords: [37.1365, 128.2121], color: 'orange' },
      { date: "5ì›” 14ì¼", time: "14:50", title: "ì¶©ì£¼ ììœ ì‹œì¥", coords: [36.9910, 127.9268], color: 'orange' },
      { date: "5ì›” 14ì¼", time: "16:10", title: "ê´´ì‚° ì „í†µì‹œì¥", coords: [36.8104, 127.7987], color: 'orange' },
      { date: "5ì›” 14ì¼", time: "17:50", title: "ì²­ì£¼ ê°€ê²½í„°ë¯¸ë„ì‹œì¥", coords: [36.6376, 127.4316], color: 'orange' },
      { date: "5ì›” 15ì¼", time: "10:00", title: "ì„¸ì¢… ê°„ë‹´íšŒ", coords: [36.5042, 127.2590], color: 'purple' },
      { date: "5ì›” 15ì¼", time: "11:00", title: "ì¡°ì¹˜ì› ì „í†µì‹œì¥", coords: [36.6010, 127.2891], color: 'purple' },
      { date: "5ì›” 15ì¼", time: "12:10", title: "ì •ë¶€ì„¸ì¢…ì²­ì‚¬ ì•", coords: [36.5043, 127.2658], color: 'purple' },
      { date: "5ì›” 15ì¼", time: "13:30", title: "êµ­ë¦½ëŒ€ì „í˜„ì¶©ì›", coords: [36.3384, 127.3085], color: 'purple' },
      { date: "5ì›” 15ì¼", time: "14:10", title: "ì¶©ë‚¨ëŒ€ ì•", coords: [36.3649, 127.3446], color: 'purple' },
      { date: "5ì›” 15ì¼", time: "15:00", title: "ì¹´ì´ìŠ¤íŠ¸ ìœ ì„¸", coords: [36.3724, 127.3628], color: 'purple' },
      { date: "5ì›” 15ì¼", time: "17:00", title: "ì´ê¸€ìŠ¤íŒŒí¬ ìœ ì„¸", coords: [36.3195, 127.4193], color: 'purple' }
    ];

    // 2) ì§€ë„ ì´ˆê¸°í™”
    const map = L.map('map').setView([36.5, 127.5], 8);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
    }).addTo(map);

    const filterControls   = document.getElementById('filter-controls');
    const scheduleList     = document.getElementById('schedule-list');
    const totalDistanceDiv = document.getElementById('total-distance');

    // ë‚ ì§œë³„ ê·¸ë£¹í•‘
    const groupedByDate = {};
    schedule.forEach(e => {
      (groupedByDate[e.date] = groupedByDate[e.date] || []).push(e);
    });

    let activeLayers = [];
    function clearMap() {
      activeLayers.forEach(l => map.removeLayer(l));
      activeLayers = [];
    }

    // 3) ì¼ì • ë Œë”ë§ í•¨ìˆ˜
    function renderSchedule(date) {
      clearMap();
      scheduleList.innerHTML = '';
      let totalDistance = 0;
      const list = date === 'ì „ì²´ ë³´ê¸°' ? schedule : (groupedByDate[date] || []);
      const latlngs = [];

      list.forEach((event, i) => {
        // ë§ˆì»¤ ì¶”ê°€
        const marker = L.circleMarker(event.coords, {
          color: event.color,
          radius: 7,
          fillOpacity: 0.8
        })
        .addTo(map)
        .bindTooltip(event.title, {
          permanent: true,
          className: 'leaflet-tooltip',
          direction: 'top',
          offset: [0, -10]
        })
        .bindPopup(`<strong>${event.time}</strong><br>${event.title}<br>${event.date}`);

        activeLayers.push(marker);
        latlngs.push(event.coords);

        // ì‚¬ì´ë“œë°” ì¼ì • ì¶”ê°€
        const li = document.createElement('li');
        li.textContent = `ğŸ•’ ${event.date} ${event.time} - ${event.title}`;
        scheduleList.appendChild(li);

        // ê±°ë¦¬ & ì„  ê·¸ë¦¬ê¸°
        if (i > 0) {
          const from = turf.point([list[i-1].coords[1], list[i-1].coords[0]]);
          const to   = turf.point([event.coords[1], event.coords[0]]);
          const dist = turf.distance(from, to, { units: 'kilometers' });
          totalDistance += dist;

          // ì„ 
          const line = L.polyline([list[i-1].coords, event.coords], { color: 'gray' }).addTo(map);
          activeLayers.push(line);

          // ì¤‘ê°„ê±°ë¦¬ ë¼ë²¨
          const midLat = (event.coords[0] + list[i-1].coords[0]) / 2;
          const midLng = (event.coords[1] + list[i-1].coords[1]) / 2;
          const label = L.tooltip({ permanent: true, className: 'leaflet-tooltip', direction: 'center' })
            .setLatLng([midLat, midLng])
            .setContent(`${dist.toFixed(2)} km`)
            .addTo(map);
          activeLayers.push(label);
        }
      });

      // ì „ì²´ ê²½ë¡œ ê·¸ë¦¬ê¸° & í™”ë©´ ë§ì¶¤
      if (latlngs.length > 1) {
        const poly = L.polyline(latlngs, { color: 'gray' }).addTo(map);
        activeLayers.push(poly);
        map.fitBounds(poly.getBounds(), { padding: [20,20] });
      }

      totalDistanceDiv.textContent = `ì´ ì´ë™ ê±°ë¦¬: ${totalDistance.toFixed(2)} km`;
    }

    // 4) í•„í„° ë²„íŠ¼ ìƒì„±
    const dates = Array.from(new Set(schedule.map(e => e.date)));
    dates.forEach(date => {
      const btn = document.createElement('button');
      btn.textContent = date;
      btn.className = 'filter-button';
      btn.onclick = () => {
        document.querySelectorAll('.filter-button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderSchedule(date);
      };
      filterControls.appendChild(btn);
    });
    // ì „ì²´ ë³´ê¸° ë²„íŠ¼
    const allBtn = document.createElement('button');
    allBtn.textContent = 'ì „ì²´ ë³´ê¸°';
    allBtn.className = 'filter-button active';
    allBtn.onclick = () => {
      document.querySelectorAll('.filter-button').forEach(b => b.classList.remove('active'));
      allBtn.classList.add('active');
      renderSchedule('ì „ì²´ ë³´ê¸°');
    };
    filterControls.appendChild(allBtn);

    // 5) ì´ˆê¸° ë Œë”
    renderSchedule('ì „ì²´ ë³´ê¸°');
  </script>
</body>
</html>
